# プロジェクト進捗状況

## プロジェクト情報

- **プロジェクト名**: OAuth2/OpenID Connect 認可サーバー
- **開始日**: 2024-10-24
- **現在のフェーズ**: セットアップ
- **最終更新**: 2025-10-26

---

## 実装フェーズ

### フェーズ1: 基盤 🔄

**ステータス**: 未開始

**目標**:
- クライアント管理（登録、保存、検証）
- ユーザー認証（基本ログイン）
- スコープ管理

**タスク**:
- [ ] データベーススキーマ設計
- [ ] Clientエンティティとテーブル作成
- [ ] Userエンティティとテーブル作成
- [ ] Scopeエンティティとテーブル作成
- [ ] クライアント登録機能
- [ ] クライアント認証機能
- [ ] ユーザー認証機能

---

### フェーズ2: 認可コードフロー ⏳

**ステータス**: 未開始

**目標**:
- 認可エンドポイント実装
- トークンエンドポイント実装
- 認可コード生成と保存
- アクセストークン生成（JWT）
- トークン検証

**タスク**:
- [ ] 認可エンドポイント設計
- [ ] 認可コード生成ロジック
- [ ] 認可コード保存
- [ ] トークンエンドポイント設計
- [ ] JWTエンコーダー実装
- [ ] アクセストークン生成
- [ ] トークン検証ロジック

---

### フェーズ3: トークン管理 ⏳

**ステータス**: 未開始

**目標**:
- リフレッシュトークン実装
- トークン取り消し
- トークンイントロスペクション

**タスク**:
- [ ] リフレッシュトークン生成
- [ ] リフレッシュトークン保存
- [ ] トークンローテーション
- [ ] トークン取り消しエンドポイント
- [ ] イントロスペクションエンドポイント

---

### フェーズ4: OpenID Connect ⏳

**ステータス**: 未開始

**目標**:
- IDトークン生成
- UserInfoエンドポイント
- ディスカバリードキュメント
- JWKSエンドポイント

**タスク**:
- [ ] IDトークン生成ロジック
- [ ] UserInfoエンドポイント実装
- [ ] Discovery document生成
- [ ] JWKSエンドポイント実装

---

### フェーズ5: 追加フロー ⏳

**ステータス**: 未開始

**目標**:
- Client Credentialsグラント
- PKCE拡張
- 動的クライアント登録

**タスク**:
- [ ] Client Credentialsフロー実装
- [ ] PKCE検証ロジック
- [ ] 動的クライアント登録エンドポイント

---

## セットアップ進捗

### 環境構築

- [x] プロジェクトディレクトリ作成
- [x] 開発ガイドライン作成
- [x] プロジェクト固有CLAUDE.md作成
- [x] ドキュメント構造作成
- [x] libsodiumインストール
- [x] bisonインストール
- [x] PHP 8.3.27インストール
- [x] Composerインストール
- [x] CakePHP 5.xインストール
- [x] .gitignoreセットアップ
- [x] テスト環境セットアップ（PHPUnit動作確認済み）
- [x] PostgreSQLセットアップ
- [x] データベース作成（idp_development, idp_test）
- [x] データベース接続確認
- [ ] 初期マイグレーション

---

## 完了したマイルストーン

### 2024-10-24

#### ドキュメント整備
- ✅ `docs/DEVELOPMENT_GUIDE.md` 作成
- ✅ `.claude/CLAUDE.md` 作成
- ✅ `docs/PROGRESS.md` 作成（このファイル）

#### 開発環境
- ✅ asdfにPHPプラグイン追加
- ✅ 必要な依存関係インストール（libsodium, bison, imagemagick等）

### 2025-10-26

#### CakePHPセットアップ完了
- ✅ PHP 8.3.27のビルドとインストール完了
- ✅ 複数の依存関係解決（libsodium, bison, re2c, pkg-config, gd, libiconv）
- ✅ Composer 2.8.12インストール
- ✅ CakePHP 5.2.9インストール
- ✅ .gitignoreファイル作成
- ✅ PHPUnit 12.4.1動作確認（9テスト成功）

#### インストールされた主要コンポーネント
- PHP 8.3.27（主要な拡張機能付き）
  - bcmath, calendar, curl, gd, intl, pdo_pgsql, pgsql など
- Composer 2.8.12
- CakePHP 5.2.9
- PHPUnit 12.4.1
- PostgreSQL 14

#### PostgreSQLセットアップ完了
- ✅ PostgreSQL 14サービス起動
- ✅ 開発用データベース作成（idp_development）
- ✅ テスト用データベース作成（idp_test）
- ✅ CakePHP設定ファイル更新（config/app_local.php）
- ✅ データベース接続確認

---

## 次のステップ

1. フェーズ1の設計を開始
   - データベーススキーマ設計
   - Client、User、Scopeエンティティ設計
2. 初期マイグレーション実装
3. フェーズ1の実装開始（クライアント管理、ユーザー認証、スコープ管理）

---

## ブロッカーと課題

### 現在のブロッカー
- なし

### 技術的課題
- OAuth2/OpenID Connectの仕様理解
- セキュリティベストプラクティスの習得
- JWT実装の詳細

---

## 学習メモ

### 学んだこと
- asdf-phpのインストールにはlibsodium、bison等の依存関係が必要
- macOSのデフォルトbisonは古いバージョン（2.3）でPHP 8.3のビルドには不適
- PHPビルド時には複数のHomebrew keg-onlyパッケージへのパスを設定する必要がある
- PKG_CONFIG_PATHに明示的にライブラリパスを追加することで、configureが依存関係を見つけられる
- CakePHP 5.xはPHPUnit 12を使用し、デフォルトで9個のテストを含む
- asdfでのPHPビルドは時間がかかるが（約40分）、完全な制御と学習の機会を提供

### 参考にしたリソース
- [asdf-php GitHub Issues](https://github.com/asdf-community/asdf-php/issues)
- PHP 8.3リリースノート

---

## 凡例

- ✅ 完了
- 🔄 進行中
- ⏳ 未開始
- ❌ ブロック中
- 📝 レビュー待ち
